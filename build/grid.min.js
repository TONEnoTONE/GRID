(function() {var k,l=this;
function m(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==
b&&"undefined"==typeof a.call)return"object";return b}function aa(a){var b=m(a);return"array"==b||"object"==b&&"number"==typeof a.length}function p(a){return"string"==typeof a}function ba(a){return"number"==typeof a}function ca(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var da="closure_uid_"+(1E9*Math.random()>>>0),ea=0;function fa(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}
var ga=Date.now||function(){return+new Date};function r(a,b){function c(){}c.prototype=b.prototype;a.o=b.prototype;a.prototype=new c}function ha(a){if(!ia.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(ja,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(ka,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(la,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(ma,"&quot;"));return a}var ja=/&/g,ka=/</g,la=/>/g,ma=/\"/g,ia=/[&<>\"]/;function na(a){return Array.prototype.join.call(arguments,"")}
function oa(a){return String(a).replace(/\-([a-z])/g,function(a,c){return c.toUpperCase()})}function pa(a){var b=p(void 0)?"undefined".replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"):"\\s";return a.replace(RegExp("(^"+(b?"|["+b+"]+":"")+")([a-z])","g"),function(a,b,f){return b+f.toUpperCase()})}
var t=Array.prototype,qa=t.indexOf?function(a,b,c){return t.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(p(a))return p(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},ra=t.forEach?function(a,b,c){t.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,f=p(a)?a.split(""):a,e=0;e<d;e++)e in f&&b.call(c,f[e],e,a)},sa=t.filter?function(a,b,c){return t.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,f=[],e=0,g=p(a)?
a.split(""):a,h=0;h<d;h++)if(h in g){var s=g[h];b.call(c,s,h,a)&&(f[e++]=s)}return f};function ta(a,b){var c=qa(a,b),d;(d=0<=c)&&t.splice.call(a,c,1);return d}function ua(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}function va(a,b,c){return 2>=arguments.length?t.slice.call(a,b):t.slice.call(a,b,c)}function u(a,b){this.x=void 0!==a?a:0;this.y=void 0!==b?b:0}k=u.prototype;k.M=function(){return new u(this.x,this.y)};
k.toString=function(){return"("+this.x+", "+this.y+")"};k.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};k.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};k.translate=function(a,b){a instanceof u?(this.x+=a.x,this.y+=a.y):(this.x+=a,ba(b)&&(this.y+=b));return this};k.scale=function(a,b){var c=ba(b)?b:a;this.x*=a;this.y*=c;return this};
function wa(a){switch(a){case "n":return 90;case "s":return 270;case "w":return 0;case "e":return 180}}function xa(a,b){var c=new u(a.x-b.x,a.y-b.y);return 0===c.x&&0<c.y?"n":0===c.x&&0>c.y?"s":0>c.x&&0===c.y?"e":0<c.x&&0===c.y?"w":null}function ya(a){this.position=a;this.d={};this.r=!1}ya.prototype.reset=function(){this.d={};this.r=!1};function za(a,b){for(var c in a)b.call(void 0,a[c],c,a)}var Aa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function Ba(a,b){for(var c,d,f=1;f<arguments.length;f++){d=arguments[f];for(c in d)a[c]=d[c];for(var e=0;e<Aa.length;e++)c=Aa[e],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}var Ca,v,Da,Ea,Fa;function Ga(){return l.navigator?l.navigator.userAgent:null}Fa=Ea=Da=v=!1;var w;if(w=Ga()){var Ha=l.navigator;v=0==w.lastIndexOf("Opera",0);Da=!v&&(-1!=w.indexOf("MSIE")||-1!=w.indexOf("Trident"));Ea=!v&&-1!=w.indexOf("WebKit");Fa=!v&&!Ea&&!Da&&"Gecko"==Ha.product}var x=v,y=Da,z=Fa,A=Ea;
function Ia(){var a=l.document;return a?a.documentMode:void 0}var Ja;a:{var Ka="",B;if(x&&l.opera)var La=l.opera.version,Ka="function"==typeof La?La():La;else if(z?B=/rv\:([^\);]+)(\)|;)/:y?B=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:A&&(B=/WebKit\/(\S+)/),B)var Ma=B.exec(Ga()),Ka=Ma?Ma[1]:"";if(y){var Na=Ia();if(Na>parseFloat(Ka)){Ja=String(Na);break a}}Ja=Ka}var Oa={};
function C(a){var b;if(!(b=Oa[a])){b=0;for(var c=String(Ja).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),d=String(a).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),f=Math.max(c.length,d.length),e=0;0==b&&e<f;e++){var g=c[e]||"",h=d[e]||"",s=/(\d*)(\D*)/g,F=/(\d*)(\D*)/g;do{var q=s.exec(g)||["","",""],n=F.exec(h)||["","",""];if(0==q[0].length&&0==n[0].length)break;b=((0==q[1].length?0:parseInt(q[1],10))<(0==n[1].length?0:parseInt(n[1],10))?-1:(0==q[1].length?0:parseInt(q[1],10))>(0==n[1].length?
0:parseInt(n[1],10))?1:0)||((0==q[2].length)<(0==n[2].length)?-1:(0==q[2].length)>(0==n[2].length)?1:0)||(q[2]<n[2]?-1:q[2]>n[2]?1:0)}while(0==b)}b=Oa[a]=0<=b}return b}var Pa=l.document,D=Pa&&y?Ia()||("CSS1Compat"==Pa.compatMode?parseInt(Ja,10):5):void 0;function E(a,b){this.width=a;this.height=b}k=E.prototype;k.M=function(){return new E(this.width,this.height)};k.toString=function(){return"("+this.width+" x "+this.height+")"};
k.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};k.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};k.scale=function(a,b){var c=ba(b)?b:a;this.width*=a;this.height*=c;return this};function Qa(a){a=a.className;return p(a)&&a.match(/\S+/g)||[]}
function G(a,b){for(var c=Qa(a),d=va(arguments,1),f=c.length+d.length,e=c,g=0;g<d.length;g++)0<=qa(e,d[g])||e.push(d[g]);a.className=c.join(" ");return c.length==f}function Ra(a,b){var c=Qa(a),d=va(arguments,1),c=Sa(c,d);a.className=c.join(" ")}function Sa(a,b){return sa(a,function(a){return!(0<=qa(b,a))})}var Ta=!y||y&&9<=D;!z&&!y||y&&y&&9<=D||z&&C("1.9.1");y&&C("9");function Ua(a){return a?new H(Va(a)):Ca||(Ca=new H)}
function Wa(a,b){za(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:d in Xa?a.setAttribute(Xa[d],b):0==d.lastIndexOf("aria-",0)||0==d.lastIndexOf("data-",0)?a.setAttribute(d,b):a[d]=b})}var Xa={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};
function I(a,b,c){var d=arguments,f=document,e=d[0],g=d[1];if(!Ta&&g&&(g.name||g.type)){e=["<",e];g.name&&e.push(' name="',ha(g.name),'"');if(g.type){e.push(' type="',ha(g.type),'"');var h={};Ba(h,g);delete h.type;g=h}e.push(">");e=e.join("")}e=f.createElement(e);g&&(p(g)?e.className=g:"array"==m(g)?G.apply(null,[e].concat(g)):Wa(e,g));2<d.length&&Ya(f,e,d);return e}
function Ya(a,b,c){function d(c){c&&b.appendChild(p(c)?a.createTextNode(c):c)}for(var f=2;f<c.length;f++){var e=c[f];if(!aa(e)||ca(e)&&0<e.nodeType)d(e);else{var g;a:{if(e&&"number"==typeof e.length){if(ca(e)){g="function"==typeof e.item||"string"==typeof e.item;break a}if("function"==m(e)){g="function"==typeof e.item;break a}}g=!1}ra(g?ua(e):e,d)}}}function Za(a){for(var b;b=a.firstChild;)a.removeChild(b)}function $a(a){a&&a.parentNode&&a.parentNode.removeChild(a)}
function Va(a){return 9==a.nodeType?a:a.ownerDocument||a.document}function H(a){this.D=a||l.document||document}H.prototype.createElement=function(a){return this.D.createElement(a)};H.prototype.createTextNode=function(a){return this.D.createTextNode(String(a))};
function ab(a){var b=a.D;a=A||"CSS1Compat"!=b.compatMode?b.body:b.documentElement;b=b.parentWindow||b.defaultView;return y&&C("10")&&b.pageYOffset!=a.scrollTop?new u(a.scrollLeft,a.scrollTop):new u(b.pageXOffset||a.scrollLeft,b.pageYOffset||a.scrollTop)}H.prototype.appendChild=function(a,b){a.appendChild(b)};function bb(a,b,c){var d;a:if(d=oa(c),void 0===a.style[d]&&(c=(A?"Webkit":z?"Moz":y?"ms":x?"O":null)+pa(c),void 0!==a.style[c])){d=c;break a}d&&(a.style[d]=b)}
function J(a,b){var c;a:{c=Va(a);if(c.defaultView&&c.defaultView.getComputedStyle&&(c=c.defaultView.getComputedStyle(a,null))){c=c[b]||c.getPropertyValue(b)||"";break a}c=""}return c||(a.currentStyle?a.currentStyle[b]:null)||a.style&&a.style[b]}
function cb(a){var b;try{b=a.getBoundingClientRect()}catch(c){return{left:0,top:0,right:0,bottom:0}}y&&a.ownerDocument.body&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop);return b}
function db(a){if(y&&!(y&&8<=D))return a.offsetParent;var b=Va(a),c=J(a,"position"),d="fixed"==c||"absolute"==c;for(a=a.parentNode;a&&a!=b;a=a.parentNode)if(c=J(a,"position"),d=d&&"static"==c&&a!=b.documentElement&&a!=b.body,!d&&(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight||"fixed"==c||"absolute"==c||"relative"==c))return a;return null}
function eb(a,b,c){if(b instanceof E)c=b.height,b=b.width;else if(void 0==c)throw Error("missing height argument");a.style.width=fb(b);a.style.height=fb(c)}function fb(a){"number"==typeof a&&(a=Math.round(a)+"px");return a}function gb(a){var b=a.offsetWidth,c=a.offsetHeight,d=A&&!b&&!c;return(void 0===b||d)&&a.getBoundingClientRect?(a=cb(a),new E(a.right-a.left,a.bottom-a.top)):new E(b,c)}function K(a,b){a.style.display=b?"":"none"}
var hb=/matrix\([0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, ([0-9\.\-]+)p?x?, ([0-9\.\-]+)p?x?\)/,ib="closure_listenable_"+(1E6*Math.random()|0);function jb(a){try{return!(!a||!a[ib])}catch(b){return!1}}var kb=0;function lb(a,b,c,d,f){this.listener=a;this.I=null;this.src=b;this.type=c;this.capture=!!d;this.O=f;this.key=++kb;this.A=this.L=!1}function mb(a){a.A=!0;a.listener=null;a.I=null;a.src=null;a.O=null}function nb(a){this.src=a;this.j={};this.J=0}
nb.prototype.add=function(a,b,c,d,f){var e=this.j[a];e||(e=this.j[a]=[],this.J++);var g;a:{for(g=0;g<e.length;++g){var h=e[g];if(!h.A&&h.listener==b&&h.capture==!!d&&h.O==f)break a}g=-1}-1<g?(a=e[g],c||(a.L=!1)):(a=new lb(b,this.src,a,!!d,f),a.L=c,e.push(a));return a};function ob(a,b){var c=b.type;if(!(c in a.j))return!1;var d=ta(a.j[c],b);d&&(mb(b),0==a.j[c].length&&(delete a.j[c],a.J--));return d}
nb.prototype.$=function(a){var b=0,c;for(c in this.j)if(!a||c==a){for(var d=this.j[c],f=0;f<d.length;f++)++b,mb(d[f]);delete this.j[c];this.J--}return b};var pb=!y||y&&9<=D,qb=y&&!C("9");!A||C("528");z&&C("1.9b")||y&&C("8")||x&&C("9.5")||A&&C("528");z&&!C("8")||y&&C("9");function L(){0!=rb&&(sb[this[da]||(this[da]=++ea)]=this)}var rb=0,sb={};L.prototype.T=!1;L.prototype.g=function(){if(!this.T&&(this.T=!0,this.b(),0!=rb)){var a=this[da]||(this[da]=++ea);delete sb[a]}};L.prototype.b=function(){if(this.Y)for(;this.Y.length;)this.Y.shift()()};
function tb(a,b){this.type=a;this.currentTarget=this.target=b}k=tb.prototype;k.b=function(){};k.g=function(){};k.H=!1;k.defaultPrevented=!1;k.stopPropagation=function(){this.H=!0};k.preventDefault=function(){this.defaultPrevented=!0};function ub(a){ub[" "](a);return a}ub[" "]=function(){};function M(a,b){a&&vb(this,a,b)}r(M,tb);k=M.prototype;k.target=null;k.relatedTarget=null;k.offsetX=0;k.offsetY=0;k.clientX=0;k.clientY=0;k.screenX=0;k.screenY=0;k.button=0;k.keyCode=0;k.charCode=0;k.ctrlKey=!1;
k.altKey=!1;k.shiftKey=!1;k.metaKey=!1;k.i=null;
function vb(a,b,c){var d=a.type=b.type;tb.call(a,d);a.target=b.target||b.srcElement;a.currentTarget=c;if(c=b.relatedTarget){if(z){var f;a:{try{ub(c.nodeName);f=!0;break a}catch(e){}f=!1}f||(c=null)}}else"mouseover"==d?c=b.fromElement:"mouseout"==d&&(c=b.toElement);a.relatedTarget=c;a.offsetX=A||void 0!==b.offsetX?b.offsetX:b.layerX;a.offsetY=A||void 0!==b.offsetY?b.offsetY:b.layerY;a.clientX=void 0!==b.clientX?b.clientX:b.pageX;a.clientY=void 0!==b.clientY?b.clientY:b.pageY;a.screenX=b.screenX||0;
a.screenY=b.screenY||0;a.button=b.button;a.keyCode=b.keyCode||0;a.charCode=b.charCode||("keypress"==d?b.keyCode:0);a.ctrlKey=b.ctrlKey;a.altKey=b.altKey;a.shiftKey=b.shiftKey;a.metaKey=b.metaKey;a.state=b.state;a.i=b;b.defaultPrevented&&a.preventDefault();delete a.H}k.stopPropagation=function(){M.o.stopPropagation.call(this);this.i.stopPropagation?this.i.stopPropagation():this.i.cancelBubble=!0};
k.preventDefault=function(){M.o.preventDefault.call(this);var a=this.i;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,qb)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};k.da=function(){return this.i};k.b=function(){};var wb="closure_lm_"+(1E6*Math.random()|0),N={},xb=0;
function yb(a,b,c,d,f){if("array"==m(b)){for(var e=0;e<b.length;e++)yb(a,b[e],c,d,f);return null}c=zb(c);if(jb(a))a=a.v(b,c,d,f);else{if(!b)throw Error("Invalid event type");var e=!!d,g=Ab(a);g||(a[wb]=g=new nb(a));c=g.add(b,c,!1,d,f);c.I||(d=Bb(),c.I=d,d.src=a,d.listener=c,a.addEventListener?a.addEventListener(b,d,e):a.attachEvent(b in N?N[b]:N[b]="on"+b,d),xb++);a=c}return a}
function Bb(){var a=Cb,b=pb?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function Db(a){if(ba(a)||!a||a.A)return!1;var b=a.src;if(jb(b))return ob(b.la,a);var c=a.type,d=a.I;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent&&b.detachEvent(c in N?N[c]:N[c]="on"+c,d);xb--;(c=Ab(b))?(ob(c,a),0==c.J&&(c.src=null,b[wb]=null)):mb(a);return!0}
function Eb(a,b,c,d){var f=1;if(a=Ab(a))if(b=a.j[b])for(b=ua(b),a=0;a<b.length;a++){var e=b[a];e&&e.capture==c&&!e.A&&(f&=!1!==Fb(e,d))}return Boolean(f)}function Fb(a,b){var c=a.listener,d=a.O||a.src;a.L&&Db(a);return c.call(d,b)}
function Cb(a,b){if(a.A)return!0;if(!pb){var c;if(!(c=b))a:{c=["window","event"];for(var d=l,f;f=c.shift();)if(null!=d[f])d=d[f];else{c=null;break a}c=d}f=c;c=new M(f,this);d=!0;if(!(0>f.keyCode||void 0!=f.returnValue)){a:{var e=!1;if(0==f.keyCode)try{f.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==f.returnValue)f.returnValue=!0}f=[];for(e=c.currentTarget;e;e=e.parentNode)f.push(e);for(var e=a.type,h=f.length-1;!c.H&&0<=h;h--)c.currentTarget=f[h],d&=Eb(f[h],e,!0,c);for(h=0;!c.H&&h<f.length;h++)c.currentTarget=
f[h],d&=Eb(f[h],e,!1,c)}return d}return Fb(a,new M(b,this))}function Ab(a){a=a[wb];return a instanceof nb?a:null}var Gb="__closure_events_fn_"+(1E9*Math.random()>>>0);function zb(a){return"function"==m(a)?a:a[Gb]||(a[Gb]=function(b){return a.handleEvent(b)})}var O={t:I("div",{id:"GameScreen","class":"screen"}),p:function(){document.body.appendChild(O.t);O.h()},q:function(){K(O.t,!0)},h:function(){K(O.t,!1)}};O.p();var P=I("div",{id:"BoardView"}),Hb=I("canvas",{id:"TileCanvas"}),Q=null;
function Ib(){var a=Q;a.save();a.translate(35,35);a.strokeStyle="#999";a.lineWidth=1;for(var b=0;9>b;b++)a.beginPath(),a.moveTo(0,70*b),a.lineTo(560,70*b),a.stroke();for(b=0;9>b;b++)a.beginPath(),a.moveTo(70*b,0),a.lineTo(70*b,560),a.stroke();a.restore()}function Jb(a,b){var c=new u(a,b);c.translate(-35,-35);c.scale(1/70);return c.floor()}P.appendChild(Hb);Q=Hb.getContext("2d");eb(P,630,630);eb(Hb,630,630);Q.canvas.width=630;Q.canvas.height=630;O.t.appendChild(P);
yb(P,"mousedown",function(a){a.stopPropagation();a=Jb(a.offsetX,a.offsetY);if(null!==Kb){var b=Lb(a);b&&b.r&&null===Mb(a)?null!==Kb&&(b=new R(Kb),b.setPosition(a),0<=qa(S,b)||S.push(b),Nb()):Nb()}});yb(P,"mouseup",function(a){Jb(a.offsetX,a.offsetY)});
var Ob=[{name:"stage0",m:[{name:"verse0",u:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],d:[],pattern:{},G:["red","green"]}]}],Pb=[{name:"stage0",m:[{name:"verse0",u:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],d:[],pattern:{},G:["red","green"]}]},{name:"stage1",m:[{name:"verse0",u:[[0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],d:[],pattern:{},G:["red","green"]}]},{name:"stage2",m:[{name:"verse0",u:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],d:[],pattern:{},G:["red","green"]}]}],T={l:Pb,na:function(a){T.l=a?Ob:Pb},ka:function(a,b,c){return{d:T.ea(a,b,c),r:0===T.l[b].m[c].u[a.y][a.x]?!1:!0}},B:function(a,
b,c){return 8<=a.x||0>a.x?0:8<=a.y||0>a.y?0:T.l[b].m[c].u[a.y][a.x]},ea:function(a,b,c){for(var d={n:!1,e:!1,s:!1,w:!1},f=T.B(a,b,c),e=[a.x,a.y],g=T.l[b].m[c],h=0;h<g.d.length;h++){var s=g.d[h][0],F=g.d[h][1];e[0]===s[0]&&e[1]===s[1]?d[xa(s,F)]=!0:e[0]===F[0]&&e[1]===F[1]&&(d[xa(F,s)]=!0)}T.F(f,T.B(new u(a.x+1,a.y),b,c))&&(d.e=!0);T.F(f,T.B(new u(a.x-1,a.y),b,c))&&(d.w=!0);T.F(f,T.B(new u(a.x,a.y-1),b,c))&&(d.n=!0);T.F(f,T.B(new u(a.x,a.y+1),b,c))&&(d.s=!0);return d},F:function(a,b){return 0===a&&
1===b||0===b&&1===a},ma:function(a){return T.l[a].m.length},ca:function(a,b){return T.l[a].m[b].G}},Qb=Array(8);function Lb(a){var b=a.x,c=a.y;return 0<=b&&8>b&&0<=c&&8>c?Qb[a.y][a.x]:null}function Rb(a){for(var b=0;8>b;b++)for(var c=0;8>c;c++){var d=new u(b,c);a(Lb(d),d)}}function Sb(){Q.clearRect(0,0,Hb.width,Hb.height);Rb(function(a){a.reset()})}
function Tb(){Ib();Rb(function(a){Q.save();Q.translate(35,35);var b=Q;if(a.r){var c=a.position.M().scale(70);a.d.s&&(b.beginPath(),b.lineWidth=4,b.strokeStyle="#fff",b.moveTo(c.x+4,c.y+70),b.lineTo(c.x+70-4,c.y+70),b.stroke());a.d.n&&(b.beginPath(),b.lineWidth=4,b.strokeStyle="#fff",b.moveTo(c.x+4,c.y),b.lineTo(c.x+70-4,c.y),b.stroke());a.d.w&&(b.beginPath(),b.lineWidth=4,b.strokeStyle="#fff",b.moveTo(c.x,c.y+4),b.lineTo(c.x,c.y+70-4),b.stroke());a.d.e&&(b.beginPath(),b.lineWidth=4,b.strokeStyle=
"#fff",b.moveTo(c.x+70,c.y+4),b.lineTo(c.x+70,c.y+70-4),b.stroke())}Q.restore()})}for(var Ub=0;8>Ub;Ub++)Qb[Ub]=Array(8);for(var Vb=0;8>Vb;Vb++)for(var Wb=0;8>Wb;Wb++)Qb[Wb][Vb]=new ya(new u(Vb,Wb));var Kb=null,U=[],Xb=I("div",{id:"PieceSelection"});function Yb(){for(var a=0;a<U.length;a++)U[a].g();U=[]}function Zb(a){Kb=a;for(var b=0;b<U.length;b++){var c=U[b];c.type===a?$b(c.view,!0):$b(c.view,!1)}}function Nb(){for(var a=0;a<U.length;a++)$b(U[a].view,!1);Kb=null}O.t.appendChild(Xb);
function V(a){L.call(this);this.fa=a;this.P={}}r(V,L);var ac=[];V.prototype.v=function(a,b,c,d,f){"array"!=m(b)&&(ac[0]=b,b=ac);for(var e=0;e<b.length;e++){var g=yb(a,b[e],c||this,d||!1,f||this.fa||this);if(!g)break;this.P[g.key]=g}return this};V.prototype.$=function(){za(this.P,Db);this.P={}};V.prototype.b=function(){V.o.b.call(this);this.$()};V.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented");};
function bc(a){L.call(this);this.f=a;this.a=I("div",{"class":"PieceView"});this.K=I("canvas",{id:"PieceViewCanvas"});this.k=I("div",{id:"MouseLayer"});this.a.appendChild(this.k);this.a.appendChild(this.K);this.context=this.K.getContext("2d");G(this.a,this.f.type);this.V=new V;this.V.v(this.k,["touchstart","mousedown"],this.ha,!1,this);this.X=new V;this.X.v(this.k,["touchend","mouseup","touchcancel","mouseout"],this.ja,!1,this);this.W=new V;this.W.v(this.k,["touchmove","mousemove"],this.ia,!1,this);
this.selected=this.N=!1;this.U=!0;this.C=0;this.f.selection?Xb.appendChild(this.a):(this.selected=!0,G(this.k,"expanded"));this.size();this.context.moveTo(47.6,11.2);this.context.lineTo(11.2,35);this.context.lineTo(47.6,58.8);this.context.strokeStyle=cc(this.f.type);this.context.lineWidth=11.2;this.context.lineCap="round";this.context.lineJoin="round";this.context.stroke()}r(bc,L);k=bc.prototype;k.b=function(){this.V.g();this.X.g();this.W.g();Za(this.a);$a(this.a);this.f=this.a=null;bc.o.b.call(this)};
k.ha=function(a){a.preventDefault();a.stopPropagation();this.selected=!0;this.f.selection?Zb(this.f.type):G(this.k,"expanded")};function $b(a,b){b?G(a.a,"selected"):Ra(a.a,"selected")}k.ja=function(a){a.preventDefault();a.stopPropagation();!this.selected||this.N||this.f.selection||this.U||(Zb(this.f.type),a=this.f,ta(S,a)&&a.g());this.U=this.N=this.selected=!1;Ra(this.k,"expanded")};
k.ia=function(a){a.preventDefault();a.stopPropagation();this.N=!0;if(this.selected&&!this.f.selection){var b=a.type;"touchstart"==b||"touchmove"==b?vb(a,a.i.targetTouches[0],a.currentTarget):"touchend"!=b&&"touchcancel"!=b||vb(a,a.i.changedTouches[0],a.currentTarget);var c=this.k;if("none"!=J(c,"display"))b=gb(c);else{var b=c.style,d=b.display,f=b.visibility,e=b.position;b.visibility="hidden";b.position="absolute";b.display="inline";c=gb(c);b.display=d;b.position=e;b.visibility=f;b=c}var g;d=this.k;
if(1==d.nodeType){var h;if(d.getBoundingClientRect)h=cb(d),h=new u(h.left,h.top);else{f=ab(Ua(d));var c=Va(d),s=J(d,"position"),F=z&&c.getBoxObjectFor&&!d.getBoundingClientRect&&"absolute"==s&&(h=c.getBoxObjectFor(d))&&(0>h.screenX||0>h.screenY),e=new u(0,0),q;h=c?Va(c):document;(q=!y)||(q=y&&9<=D)||(q="CSS1Compat"==Ua(h).D.compatMode);q=q?h.documentElement:h.body;if(d!=q)if(d.getBoundingClientRect)h=cb(d),c=ab(Ua(c)),e.x=h.left+c.x,e.y=h.top+c.y;else if(c.getBoxObjectFor&&!F)h=c.getBoxObjectFor(d),
c=c.getBoxObjectFor(q),e.x=h.screenX-c.screenX,e.y=h.screenY-c.screenY;else{h=d;do{e.x+=h.offsetLeft;e.y+=h.offsetTop;h!=d&&(e.x+=h.clientLeft||0,e.y+=h.clientTop||0);if(A&&"fixed"==J(h,"position")){e.x+=c.body.scrollLeft;e.y+=c.body.scrollTop;break}h=h.offsetParent}while(h&&h!=d);if(x||A&&"absolute"==s)e.y-=c.body.offsetTop;for(h=d;(h=db(h))&&h!=c.body&&h!=q;)e.x-=h.scrollLeft,x&&"TR"==h.tagName||(e.y-=h.scrollTop)}h=new u(e.x-f.x,e.y-f.y)}if(z&&!C(12)){y?g="-ms-transform":A?g="-webkit-transform":
x?g="-o-transform":z&&(g="-moz-transform");var n;g&&(n=J(d,g));n||(n=J(d,"transform"));g=n?(g=n.match(hb))?new u(parseFloat(g[1]),parseFloat(g[2])):new u(0,0):new u(0,0);g=new u(h.x+g.x,h.y+g.y)}else g=h}else g="function"==m(d.da),n=d,d.targetTouches?n=d.targetTouches[0]:g&&d.i.targetTouches&&(n=d.i.targetTouches[0]),g=new u(n.clientX,n.clientY);a=new u(a.clientX-g.x,a.clientY-g.y);a.translate(-b.width/2,-b.height/2);a=Jb(a.x,a.y);a=xa(new u(-1,-1),a);null!==a&&(b=this.f,b.direction!==a&&(b.direction=
a,dc(b.view)))}};k.size=function(){eb(this.K,70,70);this.context.canvas.height=70;this.context.canvas.width=70};
function dc(a){var b=a.f;if(!b.selection){b.Z?P.appendChild(a.a):$a(a.a);var c=b.direction,b=b.position.M().scale(70).translate(35,35),b=na("translate( ",b.x,"px , ",b.y,"px)"),c=wa(c)-a.C%360;-180>c?c+=360:180<c&&(c-=360);a.C+=c;c=na(b,na("rotate( ",a.C,"deg) "));b=a.a;p("transition")?bb(b,"","transition"):za("transition",fa(bb,b));a=a.a;c={transform:c,transition:na(A?"-webkit":z?"-moz":y?"-ms":x?"-o":null,"-transform 50ms")};p(c)?bb(a,void 0,c):za(c,fa(bb,a))}}
function ec(a){L.call(this);this.f=a}r(ec,L);ec.prototype.b=function(){this.f=null;ec.o.b.call(this)};function fc(){L.call(this);this.R=[];this.view=new ec(this);this.uid=Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^ga()).toString(36)}r(fc,L);fc.prototype.b=function(){for(var a=0;a<this.R.length;a++)this.R[a].g();this.R=null;fc.o.b.call(this)};
function R(a,b){L.call(this);this.type=a||gc;this.direction="w";this.position=new u(-1,-1);this.aa=new fc;this.selection=b||!1;this.Z=!1;this.view=new bc(this)}r(R,L);R.prototype.setPosition=function(a){a==this.position||a&&this.position&&a.x==this.position.x&&a.y==this.position.y||(this.Z=!0,this.position=a,dc(this.view))};R.prototype.b=function(){this.aa.g();this.aa=null;this.view.g();this.view=null;R.o.b.call(this)};var gc="red";
function cc(a){switch(a){case gc:return"#d4463f";case "green":return"#53CC66";case "blue":return"#0092D2";case "yellow":return"#F58107";case "purple":return"#CA60CA"}}var S=[];function hc(a){for(var b=0,c=S.length;b<c;b++)a(S[b],b)}function Mb(a){var b=null;hc(function(c){(c.position==a||c.position&&a&&c.position.x==a.x&&c.position.y==a.y)&&(b=c)});return b}function ic(){hc(function(a){a.g()});S=[];Yb()}var jc=0;ic();jc=jc||0;
(function(a){Sb();Rb(function(b,c){var d=T.ka(c,0,a);b.d=d.d;b.r=d.r});Tb()})(jc);var kc=jc;ic();for(var lc=T.ca(0,kc),mc=0;mc<lc.length;mc++){var nc=new R(lc[mc],!0);U.push(nc)}var W={c:null,p:function(){W.c=I("div",{id:"splash","class":"screen"},"splash");document.body.appendChild(W.c);W.h()},q:function(){K(W.c,!0)},h:function(){K(W.c,!1)}};W.p();
var X={c:null,p:function(){X.c=I("div",{id:"splash","class":"screen"},"parts is parts!");document.body.appendChild(X.c);X.h()},q:function(){K(X.c,!0)},h:function(){K(X.c,!1)}};X.p();function oc(a){L.call(this);this.a=I("div",{"class":"Button"},a);this.S=new V;this.S.v(this.a,"click",this.ba,!1,this)}r(oc,L);oc.prototype.ba=function(){console.log("CLICKED!")};oc.prototype.b=function(){Za(this.a);$a(this.a);this.a=null;this.S.g();oc.o.b.call(this)};
var Y={l:T,c:null,p:function(){Y.l=T.l;Y.ga();Y.h()},ga:function(){Y.c=I("div",{id:"SongsScreen","class":"screen"},"songs screen");document.body.appendChild(Y.c);for(var a=0;a<Pb.length;a++){var b=new oc(Pb[a].name),c=I("div",{"class":"buttonrow"});Y.c.appendChild(c);c.appendChild(b.a)}},q:function(){K(Y.c,!0)},h:function(){K(Y.c,!1)}};Y.p();var Z={};Z.SCREEN_SPLASH=W;Z.SCREEN_SONGS=Y;Z.SCREEN_PARTS=X;Z.SCREEN_GAME=O;function pc(){var a=qc;setTimeout(function(){a()},1500)}var rc={};
function $(a){console.log(a)}function qc(){rc.showgame()}
rc=StateMachine.create({events:[{name:"start",from:"none",to:"splash"},{name:"showsongs",from:"splash",to:"songs"},{name:"showsongs",from:"parts",to:"songs"},{name:"showsongs",from:"game",to:"songs"},{name:"showparts",from:"songs",to:"parts"},{name:"showparts",from:"game",to:"parts"},{name:"showgame",from:"splash",to:"game"},{name:"showgame",from:"songs",to:"game"},{name:"showgame",from:"parts",to:"game"}],callbacks:{onstart:function(){$("SPLASH!")},onbeforestart:function(){Z.SCREEN_SPLASH.q();pc()},
onbeforeshowsongs:function(){$("START   EVENT: onbeforeshowsongs!")},onbeforeshowparts:function(){$("START   EVENT: onbeforepartsToSongs!")},onbeforeshowgame:function(){$("START   EVENT: onbeforeshowgame!")},onshowsongs:function(){Z.SCREEN_SONGS.q()},onshowparts:function(){Z.SCREEN_PARTS.q()},onshowgame:function(){Z.SCREEN_GAME.q()},onleavesplash:function(){Z.SCREEN_SPLASH.h()},onleavesongs:function(){Z.SCREEN_SONGS.h()},onleaveparts:function(){Z.SCREEN_PARTS.h()},onleavegame:function(){Z.SCREEN_GAME.h()},
onsplash:function(){$("ENTER   STATE: onsplash")},onsongs:function(){$("ENTER   STATE: onsongs")},onparts:function(){$("ENTER   STATE: onparts")},ongame:function(){$("ENTER   STATE: ongame")},onchangestate:function(a,b,c){$("CHANGED STATE: "+b+" to "+c)}}});console.log("GRID version 0.0.2");rc.start();})();
